<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Postgres node.js template med d3.js</title>
  <script type="text/javascript" src="d3.js"></script>
  <style type="text/css"></style>
  <link rel="stylesheet" type="text/css" href="styles.css">
</head>

<body>
  <img id="logo" src="logo2.png" alt="logo" />

  <!--Section1-------------------------------->
  <div class="main" id="section1">
    <h1 id="head-s1">+5°C</h1>
    <br>
    <p id="text-s1">Velkommen til ferieparadiset Danmark</p>
    <div class="scrollknap"> 
      <a href="#section2" class="next round" id="s1">&#8744</a>
    </div>
  </div>
  
  <!--Section2-------------------------------->
  <div class="main" id="section2">
    <p id="text-s2">Danmarks temperaturudvikling</p>

    <div id="section2-tooltip" class="hidden">
      <p3><strong>Årstal:<span id="section-tooltip-label"> </span></strong></p3>
      <p3>+<span id="section2-tooltip-value">100</span>C°</p3>
    </div>

    <div class="scrollknap"> 
      <a href="#section3" class="next round" id="s2">&#8744</a>
    </div>
  </div>

  <!--Section3------------------------------>
  <div class="main" id="section3">
    
    <p id="text-s3">Eksempler på temperaturudviklingen i Danmark</p>
      
        <div class="column" id="c1s3"> <!--column1, section3-->
          <div class="row" id="lokalvis">
            <!-- Create a div where the graph will take place -->
            <div class="left">
              <h2 class="section3-h2">Esbjerg</h2>
              <h2 class="section3-h2">Nyborg</h2>
              <h2 class="section3-h2">Randers</h2>
              <h2 class="section3-h2">Frederikshavn</h2>
            </div>
            <div class="right">
              <p id="sluttemp">13,45°</p>
              <p id="starttemp">8,45°</p>
              <div id="c1bars3"></div>
            </div>
          </div>
        </div>

      <div class="column" id="c2s3" ><!--column2, section3-->
        <p class="positive-static" id="fish"><img class="img-s3" src="fish.png" alt="fish" />I Esbjerg er det muligt at fange hajer, ansjoser, tun og sværdfisk som nu trives i de danske farvande</p>
        <p class="positive-static" id="wine"><img class="img-s3" src="wine.png" alt="wine" />Livet som vinbonde bliver særligt rentabelt. Nyborg bliver det nye Bordeaux, da druehøsten bliver fænomenal</p>
        <p class="positive-static" id="parrot"><img class="img-s3" src="parrot.png" alt="parrot" />Randers Regnskov kan nu udvides udendørs, da flere subtropiske dyr kan overleve i det fri</p>
        <p class="positive-static" id="palm"><img class="img-s3" src="palm-tree.png" alt="palm" />Palmestranden i Frederikshavn er kåret til Danmarks ældste, da palmerne nu kan overleve vinteren udenfor</p>
      </div>

    <div class="scrollknap"> 
     <a href="#section4" class="next round" id="s3">&#8744</a>
   </div>
  </div>
  
  <!--Section4------------------------------>
  <div class="main" id="section4">
    <p id="text-s4">Konsevenserne ved +5°C ude i verden</p>

        <div class="flip-box-all">
          <div class="flip-box">
            <div class="flip-box-inner" id="box1">
              <div class="flip-box-front">
                <p class="positive-preflip" id="fish2"><img class="img1-s4" src="fish.png" alt="fish" />I Esbjerg er det muligt at fange hajer, ansjoser, tun og sværdfisk som nu trives i de danske farvande</p>
              </div>
              <div class="flip-box-back">
                <p class="negative-backflip" id="water"><img class="img2-s4" src="no-water.png" alt="vand"/> 5 milliarder mennesker kommer til at bo i områder med vandmangel</p>
              </div>
            </div>
          </div>
      
          <div class="flip-box">
            <div class="flip-box-inner"  id="box2">
              <div class="flip-box-front">
                <p class="positive-preflip" id="wine2"><img class="img1-s4" src="wine.png" alt="wine" />Livet som vinbonde bliver særligt rentabelt. Nyborg er det nye Bordeaux, da druehøsten bliver fænomenal</p>
              </div>
              <div class="flip-box-back">
                <p class="negative-backflip" id="wheat"><img class="img2-s4" src="wheat.png" alt="hvede"/>En tredjedel af fødevareproduktionen forventes at forsvinde</p>
              </div>
            </div>
          </div>
      
          <div class="flip-box">
            <div class="flip-box-inner" id="box3"> 
              <div class="flip-box-front">
                <p class="positive-preflip" id="parrot2"><img class="img1-s4" src="parrot.png" alt="parrot" />Randers Regnskov kan nu udvide udendørs, da flere subtropiske dyr kan overleve i det fri</p>
              </div>
              <div class="flip-box-back">
                <p class="negative-backflip" id="heat"><img class="img2-s4" src="global-warming.png" alt="varme"/>Dødbringende hedebølger vil udgøre en trussel for over 60% af verdensbefolkningen</p>
              </div>
            </div>
          </div>
      
          <div class="flip-box">
            <div class="flip-box-inner" id="box4">
              <div class="flip-box-front">
                <p class="positive-preflip" id="palm2"><img class="img1-s4" src="palm-tree.png" alt="palm" />Palmestranden i Frederikshavn er kåret til Danmarks ældste, da palmerne nu kan overleve vinteren udenfor</p>
              </div>
              <div class="flip-box-back">
                <p class="negative-backflip" id="migration"><img class="img2-s4" src="migration.png" alt="flygtninge"/>Cirka 1/5 af klodens befolkning bliver flygtninge, da deres hjemlande bliver for varme i sommermånederne</p> 
              </div>
            </div>
          </div>
        </div> 
    
      <div class="scrollknap"> 
        <a href="#section5" class="next round" id="s4">&#8744</a>
      </div>
  </div>
  
  <!--Section5-------------------------------->
  <div class="main" id="section5">
    <h1 id="head-s5">Imens du nyder livet i det danske ferieparadis <br> så overopheder resten af verden <br> <br> </h1>
    <p id="text-s5">Formindsk DIT klimaaftryk nu!</p>
      <form>
        <div class="buttoncontainer">
          <button class="buttons" id="transport" type="submit"
            formaction="https://www.klimaklogt.dk/guides/transport/">Transport</button>
          <button class="buttons" id="politik" type="submit"
            formaction="https://www.klimaklogt.dk/guides/politik/">Politik</button>
          <button class="buttons" id="mad" type="submit"
            formaction="https://www.klimaklogt.dk/guides/madspild/">Madspild</button>
        </div>
      </form>
      <p id="streg">_______________________________________________________<p>
      <div id="linkblok">
        <p id="links">
        <a href="https://www.dmi.dk/klimaatlas/">[1]</a>
        DMI, <i>Klimaatlas - Vejrændring år 2071-2100</i>
        <br>
        <a href="https://www.zetland.dk/historie/sOPVXmlK-aOMNamWw-638d6">[2]</a>
        Zetland, <i>"Sådan ser dit liv ud i en fem grader varmere fremtid"</i>
        <br>
        <a href="https://www.klimaklogt.dk/guides/">[3]</a>
        Naturfredningsforeningen, <i>Guides til en klimaklog hverdag</i>
      <p>
      </div>
  </div>

  <!--SCRIPT---------------------------------------------------------------------------------------------------------------------------->
  <script type="text/javascript">

    /////////////// Nedenstående er svg til Section2 //////////////////
    d3.json("/api/dmi_danmark_temp_interpolation", {method: "GET",
  }).then(function(response){

    console.log("fisk: " + response);
    const margin = { top: 100, right: -30, bottom: -30, left: -200 };
    const width = 400 - margin.left - margin.right;
    const height = 400 - margin.top - margin.bottom;
    
    var screen = window.innerWidth;
      
    const dataset_section2 = response.data;  

    const svg2 = d3.select("#section2")
                .append("svg")
                .attr("height", "100%")
                .attr("width", "100%")
                .append("g")
                .attr("transform", `translate(${margin.left + 300},${margin.top - 350})`);





    d3.select("#s1")
            
      
             var section2_p_dataset = ["°C","År"];


             d3.select("#section2").selectAll("section2-p")
            .data(section2_p_dataset)
            .enter()
            .append("p")
            .attr("id","section2-p")
            .style("position","absolute")
            .style("left",function(d,i){
                return  i == 0 ?  screen/2 - (width) - margin.left * 1.1 +"px" : screen/2 - (width) - margin.left * 4.5 + "px";
            })  
            .style("top",function(d,i){
                return i == 0 ? (height - margin.top*2.6) + "px": (height - margin.bottom*2.6)+ "px";
            })  
            .text(function(d){
                return d;
            });
          
      const parseTime = d3.timeParse("%Y");
          
      const x = d3.scaleTime()
                .domain([parseTime(2010),parseTime(2100)])
                .range([0, width]);
          
       svg2.append("g")
              .attr("transform", "translate(" + (screen/2 - (width) - margin.left + margin.right * 2)  +"," + height *1.8 + ")")
              .call(d3.axisBottom(x));
      

         
      const y = d3.scaleLinear()
      .domain([0.0, 5.0])
      .range([height, 0]);
      var ffwt = [0];
      
      var textData = [0, 1];
      
    svg2.append("g")
    .attr("transform", "translate(" + (screen/2 - (width) - margin.left + margin.right * 2)  +","+  (height * 0.8)  +")")
      .call(d3.axisLeft(y)
      );
      
   
      
      var current_tempprocent = 1;
      
      //console.log(dataset_section2);
      var rZeroFlag = false;
      svg2.append("g")
      .selectAll("dot")
      .data(dataset_section2)
      .join("circle")
      .attr("cx", function (d, i) {
       
        return x(parseTime(d.aar)) + (screen/2 - (width) - margin.left + margin.right * 2);
        
      })
      .attr("cy", function (d, i) {
        
        return y(parseFloat(d.temp_procent).toFixed(5))+  (height * 0.8);
      })
      .attr("r", function (d,i) {

        
        var returning = d.temp_procent.toString().length > 4 ? 3.6 : 12;
        
        if (rZeroFlag) {
          returning = 0;
          rZeroFlag = false;
        }
        if (dataset_section2[i].temp_procent.toString().length == 4) {
          rZeroFlag = true;
        }

        return returning;
      })
      .on("mouseenter", function (event, d) {
        

        console.log("FIsk: d: " + d.temp_procent + " length: " + (d.temp_procent.toString().length));
        if(d.temp_procent.toString().length  < 6){

          
          d3.select("#section2-tooltip")
          
          .style("left", "0", +"px")
          .style("top", "300" + "px")
          .select("#value")
          .text(d);
          d3.select("#section2-tooltip").classed("hidden", false);
          d3.select(this).attr("fill","orange");
        }
        
        d3.select("#section-tooltip-label")
        .text(" " + d.aar)
        d3.select("#section2-tooltip-value")
        .text( d.temp_procent);
        
        
      })
      .on("mouseout", function (d) {
        d3.select("#section2-tooltip").classed("hidden", true);
        d3.select(this).attr("fill","black");
      })
      
      
    });



    /////////////// Ovenstående er svg til Section2 //////////////////


    /////////////// Nedenstående er svg til Section3 //////////////////
    d3.json("api/Temperatur", {method: "GET",
    }).then(function(response){

      console.log(response);
        //SKRIV KODEN HER
        var dataset = response.data;
function dataForLooper(start,length,datasetFrom){
var datasetAddTo = []
for (let i = start; i < length; i++) {
    datasetAddTo.push(datasetFrom[i]);
}
return datasetAddTo;
}
var data1 = dataForLooper(43,44,dataset); 
var data2 = dataForLooper(243,244,dataset);
var data3 = dataForLooper(263,264,dataset);
var data4 = dataForLooper(71,72,dataset)
//Esbjerg = data1
//Nyborg = data2
//Randers = data3
//Frederikshavn = data4

//var data4 = [] // ALT HER KAN BRUGES TIL AT FINDE ET DATASET!
//for (let i = 68; i < 72; i++) {
//   data4.push(dataset[i])
//console.table(data4)
 // ALT HER KAN BRUGES TIL AT FINDE ET DATASET!/
var svg = d3.select("#c1bars3")
.append("svg")
.attr("height", (vh(73)))
.attr("width", (vh(100)));

svg.append('line')
  .style("stroke", "whitesmoke")
  .style("stroke-width", 2)
  .attr("x1", 0)
  .attr("y1", (vh(12.13)))
  .attr("x2", 0)
  .attr("y2", (vh(71)));

  svg.append('line')
  .style("stroke", "whitesmoke")
  .style("stroke-dasharray", 8)
  .attr("x1", (vh(53)))
  .attr("y1", (vh(12.13)))
  .attr("x2", (vh(53)))
  .attr("y2", (vh(71)));


//Maria's viewport funtion
function vh(v) {
  var h = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
  return (v * h) / 100;
}

var dinfar = data1.concat(data2,data3,data4) //Viser den fjerde bar for alle data# 🙂
var bars = svg.selectAll("rect")
        .data(dinfar)
        .enter()
        .append("rect")
        .attr("height", function(d, i){
            console.log(d.temp);
            return (vh(6.9));
           // return 100 + (i * 10) + 10 * i;
        })
        .attr("width", function(d){
            return d.temp * (vh(3.5))
        })
        .attr("x", 2.2)

        .attr("y",function(d,i){
            return (vh(12.13)) + (i * (vh(17.35))) + (vh(0)) * i;})
            
            .attr("fill", "rgb(58, 158, 78")


        //Viser tekst til barene 🙂
        var datatext = [1,2,3,4];
        svg.selectAll("text")
        .data(datatext)
        .enter()
        .append("text")
        .attr("x", (vh(35)))
        .attr("fill", "whitesmoke")
        .attr("y",function(d,i){
            return (vh(16.5)) + (i * (vh(15.45))) + (vh(1.9)) * i;})
        .text(function (d,i) {
            console.log("d: "+d)
            switch (d) {
                case 1:
                    return data1[0].temp+"°";
              case 2:
                  return data2[0].temp+"°";
                case 3:
                    return data3[0].temp+"°";
                case 4:
                    return data4[0].temp+"°";
            }
            //Viser alle 4 højeste grader 🙂
        });

    });



//HER SLUTTER KODEN
//console.log(response.data) //Viser al data (396 Arrays)
//console.log(response.data[0].temp) //Viser første temp
//console.log(response.data[1].temp) //Viser anden temp
//console.log(response.data[2].temp) //Viser tredje temp
//console.log(response.data[3].temp) //Viser fjerde temp
    
    /////////////// Ovenstående er svg til Section3 //////////////////


    /////////////// Nedenstående er flip box til Section4 //////////////////
      function change() {
      const elements = document.querySelectorAll(".flip-box");
        for (let element of elements) {
      element.classList.toggle("transformed-state");
       }

      }
      const changeButton = document.querySelector("#s3");
      changeButton.addEventListener("click", change); 
    /////////////// Ovenstående er flip box til Section4 //////////////////
  </script>
</body>

</html>